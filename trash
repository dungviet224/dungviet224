local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

local Library = {}
Library.__index = Library
Library.ToggleUI = Enum.KeyCode.RightControl -- Default toggle key
Library.Draggable = true -- Enable dragging
Library.MinimizeKey = Enum.KeyCode.M -- Minimize shortcut key
Library.Theme = {
    Background = Color3.fromRGB(30, 30, 30),
    Header = Color3.fromRGB(40, 40, 40),
    Text = Color3.fromRGB(255, 255, 255),
    Button = Color3.fromRGB(40, 40, 40),
    ButtonHover = Color3.fromRGB(50, 50, 50),
    Toggle = Color3.fromRGB(60, 120, 255),
    Slider = Color3.fromRGB(60, 120, 255)
}

-- Create the main UI window
function Library:CreateWindow(windowTitle)
    local window = Instance.new("ScreenGui")
    local main = Instance.new("Frame")
    local header = Instance.new("Frame")
    local minimize = Instance.new("TextButton")
    local title = Instance.new("TextLabel")
    local tabContainer = Instance.new("Frame")
    local contentContainer = Instance.new("Frame")

    -- Configure ScreenGui
    if syn and syn.protect_gui then
        syn.protect_gui(window)
        window.Parent = CoreGui
    else
        window.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    end
    window.Name = "UILibrary"
    window.ResetOnSpawn = false
    window.DisplayOrder = 999

    -- Main frame
    main.Name = "Main"
    main.Size = UDim2.new(0, 450, 0, 350)
    main.Position = UDim2.new(0.5, -225, 0.5, -175)
    main.BackgroundColor3 = Library.Theme.Background
    main.BorderSizePixel = 0
    main.ClipsDescendants = true
    main.Parent = window

    -- Rounded corners
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 5)
    corner.Parent = main

    -- Header
    header.Name = "Header"
    header.Size = UDim2.new(1, 0, 0, 30)
    header.BackgroundColor3 = Library.Theme.Header
    header.BorderSizePixel = 0
    header.Parent = main

    minimize.Name = "Minimize"
    minimize.Size = UDim2.new(0, 30, 0, 30)
    minimize.Position = UDim2.new(1, -30, 0, 0)
    minimize.BackgroundTransparency = 1
    minimize.Text = "-"
    minimize.TextColor3 = Library.Theme.Text
    minimize.TextSize = 20
    minimize.Font = Enum.Font.GothamBold
    minimize.Parent = header

    title.Name = "Title"
    title.Size = UDim2.new(1, -60, 1, 0)
    title.Position = UDim2.new(0, 10, 0, 0)
    title.BackgroundTransparency = 1
    title.Text = windowTitle
    title.TextColor3 = Library.Theme.Text
    title.TextSize = 14
    title.Font = Enum.Font.GothamBold
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Parent = header

    -- Tab and Content Containers
    tabContainer.Name = "TabContainer"
    tabContainer.Size = UDim2.new(0, 120, 1, -30)
    tabContainer.Position = UDim2.new(0, 0, 0, 30)
    tabContainer.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    tabContainer.BorderSizePixel = 0
    tabContainer.Parent = main

    contentContainer.Name = "ContentContainer"
    contentContainer.Size = UDim2.new(1, -120, 1, -30)
    contentContainer.Position = UDim2.new(0, 120, 0, 30)
    contentContainer.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    contentContainer.BorderSizePixel = 0
    contentContainer.Parent = main

    -- Dragging functionality
    if Library.Draggable then
        local dragging = false
        local dragStart
        local startPos

        header.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                dragStart = input.Position
                startPos = main.Position
            end
        end)

        header.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end)

        UserInputService.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                local delta = input.Position - dragStart
                main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            end
        end)
    end

    -- Minimize functionality
    local minimized = false
    minimize.MouseButton1Click:Connect(function()
        minimized = not minimized
        local targetSize = minimized and UDim2.new(1, 0, 0, 30) or UDim2.new(1, 0, 1, 0)
        TweenService:Create(main, TweenInfo.new(0.3), {Size = targetSize}):Play()
        minimize.Text = minimized and "+" or "-"
    end)

    return {
        Window = window,
        Main = main,
        TabContainer = tabContainer,
        ContentContainer = contentContainer
    }
end

-- The rest of your script should follow similar improvements.
